---

title: CLI


keywords: fastai
sidebar: home_sidebar

summary: "Command line scripts."
description: "Command line scripts."
nb_path: "nbs/06_cli.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_cli.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="banet_viirs375_download" class="doc_header"><code>banet_viirs375_download</code><a href="https://github.com/mnpinto/banet/tree/master/banet/cli.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>banet_viirs375_download</code>(<strong><code>region</code></strong>:<code>Param object at 0x7f588982fd00&gt;</code>, <strong><code>tstart</code></strong>:<code>Param object at 0x7f588982fa00&gt;</code>, <strong><code>tend</code></strong>:<code>Param object at 0x7f58356b42e0&gt;</code>, <strong><code>path_save</code></strong>:<code>Param object at 0x7f5835553a90&gt;</code>, <strong><code>regions_path</code></strong>:<code>Param object at 0x7f58354cde80&gt;</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l </span>
<span class="nv">region</span><span class="o">=</span><span class="s2">&quot;PI&quot;</span>
<span class="nv">tstart</span><span class="o">=</span><span class="s2">&quot;2017-10-27 00:00:00&quot;</span>
<span class="nv">tend</span><span class="o">=</span><span class="s2">&quot;2017-10-27 23:59:59&quot;</span>
<span class="nv">path_save</span><span class="o">=</span><span class="s2">&quot;/srv/banet/data/rawdata&quot;</span>
<span class="nv">regions_path</span><span class="o">=</span><span class="s2">&quot;/srv/banet/data/regions&quot;</span>
banet_viirs375_download <span class="nv">$region</span> <span class="s2">&quot;</span><span class="nv">$tstart</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$tend</span><span class="s2">&quot;</span> <span class="nv">$path_save</span> <span class="nv">$regions_path</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="banet_viirs750_download" class="doc_header"><code>banet_viirs750_download</code><a href="https://github.com/mnpinto/banet/tree/master/banet/cli.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>banet_viirs750_download</code>(<strong><code>region</code></strong>:<code>Param object at 0x7f57c37fdee0&gt;</code>, <strong><code>tstart</code></strong>:<code>Param object at 0x7f57c37fdf10&gt;</code>, <strong><code>tend</code></strong>:<code>Param object at 0x7f57c37fdf70&gt;</code>, <strong><code>path_save</code></strong>:<code>Param object at 0x7f57c37fdf40&gt;</code>, <strong><code>regions_path</code></strong>:<code>Param object at 0x7f57c380b730&gt;</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l </span>
<span class="nv">region</span><span class="o">=</span><span class="s2">&quot;PI&quot;</span>
<span class="nv">tstart</span><span class="o">=</span><span class="s2">&quot;2017-10-27 00:00:00&quot;</span>
<span class="nv">tend</span><span class="o">=</span><span class="s2">&quot;2017-10-27 23:59:59&quot;</span>
<span class="nv">path_save</span><span class="o">=</span><span class="s2">&quot;/srv/banet/data/rawdata&quot;</span>
<span class="nv">regions_path</span><span class="o">=</span><span class="s2">&quot;/srv/banet/data/regions&quot;</span>
banet_viirs750_download <span class="nv">$region</span> <span class="s2">&quot;</span><span class="nv">$tstart</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$tend</span><span class="s2">&quot;</span> <span class="nv">$path_save</span> <span class="nv">$regions_path</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="banet_create_dataset" class="doc_header"><code>banet_create_dataset</code><a href="https://github.com/mnpinto/banet/tree/master/banet/cli.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>banet_create_dataset</code>(<strong><code>region</code></strong>:<code>Param object at 0x7f57c380b760&gt;</code>, <strong><code>viirs_path</code></strong>:<code>Param object at 0x7f57c380b790&gt;</code>, <strong><code>fires_path</code></strong>:<code>Param object at 0x7f57c380b850&gt;</code>, <strong><code>save_path</code></strong>:<code>Param object at 0x7f57c380b820&gt;</code>, <strong><code>regions_path</code></strong>:<code>Param object at 0x7f57c380b7f0&gt;</code>, <strong><code>mcd64_path</code></strong>:<code>Param object at 0x7f57c380b7c0&gt;</code>=<em><code>None</code></em>, <strong><code>cci51_path</code></strong>:<code>Param object at 0x7f57c380b880&gt;</code>=<em><code>None</code></em>, <strong><code>bands</code></strong>:<code>Param object at 0x7f57c380b8b0&gt;</code>=<em><code>['Reflectance_M5', 'Reflectance_M7', 'Reflectance_M10', 'Radiance_M12', 'Radiance_M15', 'SolarZenithAngle', 'SatelliteZenithAngle']</code></em>, <strong><code>year</code></strong>:<code>Param object at 0x7f57c380b8e0&gt;</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Examples:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="nv">region</span><span class="o">=</span>PI
<span class="nv">viirs_path</span><span class="o">=</span>/srv/banet/data/rawdata
<span class="nv">mcd64_path</span><span class="o">=</span>/srv/mcd64
<span class="nv">cci51_path</span><span class="o">=</span>/srv/BA_validation/data/FireCCI51
<span class="nv">save_path</span><span class="o">=</span>/srv/banet/data/procdata
<span class="nv">fires_path</span><span class="o">=</span>/srv/banet/data/hotspots
<span class="nv">regions_path</span><span class="o">=</span>/srv/banet/data/regions

<span class="c1"># Create dataset only for VIIRS</span>
banet_create_dataset <span class="nv">$region</span> <span class="nv">$viirs_path</span> <span class="nv">$fires_path</span> <span class="nv">$save_path</span> <span class="se">\</span>
                     <span class="nv">$regions_path</span> --year<span class="o">=</span><span class="m">2017</span>

<span class="c1"># Create dataset for VIIRS and MCD64A1C6</span>
banet_create_dataset <span class="nv">$region</span> <span class="nv">$viirs_path</span> <span class="nv">$fires_path</span> <span class="nv">$save_path</span> <span class="se">\</span>
                     <span class="nv">$regions_path</span> --mcd64_path <span class="nv">$mcd64_path</span> --year<span class="o">=</span><span class="m">2017</span>

<span class="c1"># Create dataset for VIIRS, MCD64A1C6 and FireCCI51 data.</span>
banet_create_dataset <span class="nv">$region</span> <span class="nv">$viirs_path</span> <span class="nv">$fires_path</span> <span class="nv">$save_path</span> <span class="se">\</span>
                     <span class="nv">$regions_path</span> --mcd64_path <span class="nv">$mcd64_path</span> <span class="se">\</span>
                     --cci51_path <span class="nv">$cci51_path</span> --year<span class="o">=</span><span class="m">2017</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="banet_dataset2tiles" class="doc_header"><code>banet_dataset2tiles</code><a href="https://github.com/mnpinto/banet/tree/master/banet/cli.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>banet_dataset2tiles</code>(<strong><code>region</code></strong>:<code>Param object at 0x7f57c380b940&gt;</code>, <strong><code>input_path</code></strong>:<code>Param object at 0x7f57c380b970&gt;</code>, <strong><code>output_path</code></strong>:<code>Param object at 0x7f57c380ba30&gt;</code>, <strong><code>size</code></strong>:<code>Param object at 0x7f57c380ba00&gt;</code>=<em><code>128</code></em>, <strong><code>step</code></strong>:<code>Param object at 0x7f57c380b9d0&gt;</code>=<em><code>100</code></em>, <strong><code>year</code></strong>:<code>Param object at 0x7f57c380b9a0&gt;</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Examples:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="nv">input_path</span><span class="o">=</span>/srv/banet/data/procdata
<span class="nv">output_path</span><span class="o">=</span>/srv/banet/data/tiles/train
<span class="nv">region</span><span class="o">=</span>PI

banet_dataset2tiles <span class="nv">$region</span> <span class="nv">$input_path</span> <span class="nv">$output_path</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="banet_predict_monthly" class="doc_header"><code>banet_predict_monthly</code><a href="https://github.com/mnpinto/banet/tree/master/banet/cli.py#L127" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>banet_predict_monthly</code>(<strong><code>region</code></strong>:<code>Param object at 0x7f57c380ba90&gt;</code>, <strong><code>input_path</code></strong>:<code>Param object at 0x7f57c380bac0&gt;</code>, <strong><code>output_path</code></strong>:<code>Param object at 0x7f57c380bb80&gt;</code>, <strong><code>year</code></strong>:<code>Param object at 0x7f57c380bb50&gt;</code>, <strong><code>weight_files</code></strong>:<code>Param object at 0x7f57c380bb20&gt;</code>=<em><code>['/home/mnpinto/.banet/models/banetv0.20-val2017-fold0.pth', '/home/mnpinto/.banet/models/banetv0.20-val2017-fold1.pth', '/home/mnpinto/.banet/models/banetv0.20-val2017-fold2.pth']</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="nv">input_path</span><span class="o">=</span>/srv/banet/data/procdata
<span class="nv">output_path</span><span class="o">=</span>/srv/banet/data/monthly
<span class="nv">region</span><span class="o">=</span>PI
<span class="nv">year</span><span class="o">=</span><span class="m">2017</span>

banet_predict_monthly <span class="nv">$region</span> <span class="nv">$input_path</span> <span class="nv">$output_path</span> <span class="nv">$year</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="banet_predict_times" class="doc_header"><code>banet_predict_times</code><a href="https://github.com/mnpinto/banet/tree/master/banet/cli.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>banet_predict_times</code>(<strong><code>region</code></strong>:<code>Param object at 0x7f57c380bbb0&gt;</code>, <strong><code>tstart</code></strong>:<code>Param object at 0x7f57c380bbe0&gt;</code>, <strong><code>tend</code></strong>:<code>Param object at 0x7f57c380bca0&gt;</code>, <strong><code>input_path</code></strong>:<code>Param object at 0x7f57c380bc70&gt;</code>, <strong><code>output_path</code></strong>:<code>Param object at 0x7f57c380bc40&gt;</code>, <strong><code>regions_path</code></strong>:<code>Param object at 0x7f57c380bc10&gt;</code>, <strong><code>product</code></strong>:<code>Param object at 0x7f57c380bcd0&gt;</code>=<em><code>'VIIRS750'</code></em>, <strong><code>output</code></strong>:<code>Param object at 0x7f57c380bd00&gt;</code>=<em><code>'data'</code></em>, <strong><code>weight_files</code></strong>:<code>Param object at 0x7f57c380bd30&gt;</code>=<em><code>['/home/mnpinto/.banet/models/banetv0.20-val2017-fold0.pth', '/home/mnpinto/.banet/models/banetv0.20-val2017-fold1.pth', '/home/mnpinto/.banet/models/banetv0.20-val2017-fold2.pth']</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="nv">region</span><span class="o">=</span><span class="s2">&quot;PI&quot;</span>
<span class="nv">tstart</span><span class="o">=</span><span class="s2">&quot;2017-06-01&quot;</span> <span class="c1"># Predict from 1 June to 31 October</span>
<span class="nv">tend</span><span class="o">=</span><span class="s2">&quot;2017-10-01&quot;</span>
<span class="nv">input_path</span><span class="o">=</span><span class="s2">&quot;/srv/banet/data/procdata&quot;</span>
<span class="nv">output_path</span><span class="o">=</span><span class="s2">&quot;/srv/banet/data/monthly&quot;</span>
<span class="nv">regions_path</span><span class="o">=</span><span class="s2">&quot;/srv/banet/data/regions&quot;</span>

banet_predict_times <span class="nv">$region</span> <span class="s2">&quot;</span><span class="nv">$tstart</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$tend</span><span class="s2">&quot;</span> <span class="nv">$input_path</span> <span class="nv">$output_path</span> <span class="nv">$regions_path</span>
</pre></div>

</div>
</div>
</div># export
@call_parse
def banet_train_model(val_year:Param('Validation year', int),
                r_fold:Param('Fold name', str),
                input_path:Param("Input path for tiles dataset", str),
                output_path:Param("Path to save the model weights", str),
                n_epochs:Param("Number of epochs to train", int)=8,
                lr:Param("Learning rate", float)=1e-2,
                nburned:Param("Minimum number of burned pixels to define a sequence", int)=10,
                n_episodes_train:Param("Number of episodes per train epoch", int)=2000,
                n_episodes_valid:Param("Number of episodes for validation", int)=100,
                sequence_len:Param("Number of time-steps in sequence", int)=64,
                n_sequences:Param("Number of sequences per batch", int)=1,
                pretrained_weights:Param("Path to a weights file", str)=None):

    path = Path(input_path)
    model_path = Path(output_path)
    print(f'Training model for {val_year}, fold {r_fold}:')
    train_model(val_year, r_fold, path, model_path, n_epochs, lr, nburned,
                n_episodes_train, n_episodes_valid, sequence_len, n_sequences,
                pretrained_weights=pretrained_weights)Example:
```bash
#!/bin/bash -l
val_year=2018
fold_name=99
input_path=/srv/banet/data/tiles/train
output_path=/srv/banet/data/models

banet_train_model $val_year $fold_name $input_path $output_path
```
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="banet_nrt_run" class="doc_header"><code>banet_nrt_run</code><a href="https://github.com/mnpinto/banet/tree/master/banet/cli.py#L169" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>banet_nrt_run</code>(<strong><code>region</code></strong>:<code>Param object at 0x7f57c380bd90&gt;</code>, <strong><code>left</code></strong>:<code>Param object at 0x7f57c380bdc0&gt;</code>, <strong><code>bottom</code></strong>:<code>Param object at 0x7f57c380be80&gt;</code>, <strong><code>right</code></strong>:<code>Param object at 0x7f57c380be50&gt;</code>, <strong><code>top</code></strong>:<code>Param object at 0x7f57c380be20&gt;</code>, <strong><code>project_path</code></strong>:<code>Param object at 0x7f57c380bdf0&gt;</code>, <strong><code>hotspots_region</code></strong>:<code>Param object at 0x7f57c380beb0&gt;</code>, <strong><code>product</code></strong>:<code>Param object at 0x7f57c380bee0&gt;</code>=<em><code>'VIIRS750'</code></em>, <strong><code>area_epsg</code></strong>:<code>Param object at 0x7f57c380bf10&gt;</code>=<em><code>3763</code></em>, <strong><code>pixel_size</code></strong>:<code>Param object at 0x7f57c380bf40&gt;</code>=<em><code>0.01</code></em>, <strong><code>time</code></strong>:<code>Param object at 0x7f57c380bf70&gt;</code>=<em><code>'today'</code></em>, <strong><code>threshold</code></strong>:<code>Param object at 0x7f57c380bfa0&gt;</code>=<em><code>0.5</code></em>, <strong><code>skip_hotspots</code></strong>:<code>Param object at 0x7f57c380bfd0&gt;</code>=<em><code>False</code></em>, <strong><code>skip_ladsweb</code></strong>:<code>Param object at 0x7f57c3813040&gt;</code>=<em><code>False</code></em>, <strong><code>skip_preprocess</code></strong>:<code>Param object at 0x7f57c3813070&gt;</code>=<em><code>False</code></em>, <strong><code>skip_getpreds</code></strong>:<code>Param object at 0x7f57c38130a0&gt;</code>=<em><code>False</code></em>, <strong><code>skip_postprocess</code></strong>:<code>Param object at 0x7f57c38130d0&gt;</code>=<em><code>False</code></em>, <strong><code>single_fold</code></strong>:<code>Param object at 0x7f57c3813100&gt;</code>=<em><code>False</code></em>, <strong><code>max_size</code></strong>:<code>Param object at 0x7f57c3813130&gt;</code>=<em><code>2000</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>hotspots_region</code> name should be defined according with the image bellow. Names with multiple words use <code>_</code> in place of the spaces. More info here: <a href="https://firms.modaps.eosdis.nasa.gov/active_fire/#firms-txt">https://firms.modaps.eosdis.nasa.gov/active_fire/#firms-txt</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://firms.modaps.eosdis.nasa.gov/images/Regions_500px.jpg&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<img src="https://firms.modaps.eosdis.nasa.gov/images/Regions_500px.jpg"/>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="nv">region</span><span class="o">=</span>PI
<span class="nv">project_path</span><span class="o">=</span>data
<span class="nv">hotspots_region</span><span class="o">=</span>Europe
banet_nrt_run <span class="nv">$region</span> -10 <span class="m">36</span> <span class="m">5</span> <span class="m">44</span> <span class="nv">$project_path</span> <span class="nv">$hotspots_region</span> --pixel_size <span class="m">0</span>.001 --area_epsg <span class="m">3763</span>
</pre></div>
<p><strong>Important:</strong> Note that hotspots will only be automatically downloaded starting 7 days ago from the current date. If you want to compute burned areas for an earlier period you need to manually donwload the active fires data.</p>

</div>
</div>
</div>
</div>
 

